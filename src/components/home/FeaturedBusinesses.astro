---
import { supabase } from "../../lib/supabase";
import BusinessCard from "../negocios/BusinessCard";
import { getBusinessStatus } from "../../lib/businessHours";

const { data: featuredBusinesses, error } = await supabase
  .from("businesses")
  .select(
    `
    *,
    business_hours (
      day_of_week,
      open_time,
      close_time,
      is_closed
    )
  `
  )
  .eq("is_active", true)
  .eq("is_featured", true)
  .order("priority", { ascending: false })
  .limit(6);

const businessesWithStatus = featuredBusinesses?.map((business) => {
  const status = getBusinessStatus(business.business_hours ?? []);

  return {
    ...business,
    is_open: status.is_open,
    status_label: status.label,
  };
});
---

<section class="mx-auto max-w-6xl px-6 py-12">
  <div class="flex flex-col gap-8 items-center">
    <h2 class="text-2xl font-bold text-gray-800">Comercios Destacados</h2>

    <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-4">
      {
        businessesWithStatus?.map((business) => (
          <BusinessCard business={business} />
        ))
      }
    </div>

    <div class="transition-transform hover:scale-102">
      <a
        href="/negocios"
        class="rounded-xl bg-primary px-6 py-3 font-semibold text-white transition-transform hover:scale-110 hover:bg-green-700"
      >
        Ver todos
      </a>
    </div>
  </div>
</section>
